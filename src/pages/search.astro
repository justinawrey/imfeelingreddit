---
import Shell from "@layouts/Shell.astro";
import SearchResult from "@components/SearchResult.astro";
import Title from "@components/Title.astro";
import SearchWidget from "@components/islands/SearchWidget";
import { searchAll } from "@api-client/search";

const query = Astro.url.searchParams.get("query");

if (!query) {
  return Astro.redirect("/");
}

const searchResults = await searchAll(query, Astro.url);
---

<Shell>
  <main class="h-full space-y-8 ml-24 mt-8">
    <Title />
    <SearchWidget initialText={query} focus={false} client:load />
    {
      searchResults.map(({ title, link, highlightedSnippet, displayLink }) => (
        <SearchResult
          title={title}
          link={link}
          snippet={highlightedSnippet}
          displayLink={displayLink}
        />
      ))
    }
  </main>
</Shell>
